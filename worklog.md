# Worklog

Keeping track of the work done each week. This worklog is best viewed in a text editor that can interpret the Markdown (.md) format. For those not viewing on GitHub already, [here is a link to this file on GitHub.](https://github.com/chbkull/mus499c-sp22/blob/main/worklog.md)

## 1/27

This week was spent putting together a sound library to use as a starting point for the composition. Some of the library was recently recorded (candle jar, ice, gingersnap box, etc.), and the rest of the library was from the recordings I took for Music 409 about a year ago. This sound library is by no means complete, and if I encounter any sonically interesting objects I'll be sure to record them and add them in as well. I may also continue to scour my 409 library as there are a lot of files in there that may come of use.

One other thing of note- I was using Audacity to record the sounds and it turns out I made an error with some of my recordings. When I was exporting the chopped up audio I was mistakenly using "Export as WAV" rather than "Export Selected Audio," which causes some of the recordings I did to hold the entire track rather than the portion cut down to the sample itself. Objects affected by this include: candle jar, cardboard tube, gingersnap box, ice, salt shaker, Yeti bottle, and rubber band. I'll spend some time the following week cutting these samples back down to what I had originally intended.

## 1/31

Took time today to correct the mistake I made last week around saving entire tracks of samples instead of individual samples. Huge credit to the [Nyquist Effect Audacity plugin Trim Silence](https://wiki.audacityteam.org/wiki/Nyquist_Effect_Plug-ins#Trim_Silence) for speeding up this process immensely. Trim silence takes an audio clip and removes silence below a certain threshold from *only* the start and the end of the clip. Perfect for cleaning up the tracks that were relatively clean and only had silence between them. I ended up running all of my samples through trim silence to get rid of any extra silence. The settings I used were a threshold of -48 dB with 0 sec of silence left at both the start and end.

An interesting way to put it is, prior to clean up, the `SoundLibrary` folder was \~170 MB, and after it was \~67 MB, so that's just over 100 MB of silence removed. Even then this estimate is slightly conservative as I went back through my raw recordings and added in a few more samples from the gingersnap box, ice, rubberband, salt shaker, and Yeti bottle.

## 2/1

Not added to the repository yet, but I took Prof. Fieldsteel's code that unpacks a library into an event and quickly plays through all of the different sounds. The ones that caught my attention today were the "resonator" samples from my Swell bottle. Clear fundamental with relatively clean harmonics, so a basic sound. As a refresher to get back into SuperCollider, I set up a simple `SynthDef` and `Pbind` to just play through the sample with varied random parameters. The work is located in `chimes.scd`.

## 2/3

Went back and recorded three more objects: a plastic Rinse-Aid bottle, a big metal bowl, and a small metal bowl (I was inspired by Prof. Fieldsteel's water warbling effect that I decided to try and record some for my self as well). The recordings can be found in the `SoundLibrary` folder.

Reorganized the directories by adding an `Ideas` folder. Plan is that inside will be some smaller SuperCollider files that play around with specific UGens or patterns. For this week, there are two such files inside. One is `chimes.scd`, which has been changed to use the resonate samples from the big metal bowl. Basic `Pbind` setup where two sample players are running in parallel. Nothing too rhythmic or complex, but it does remind me a bit of singing bowls, albeit played at a faster rate. The other is `dynklank.scd`, which is where I'm exploring the `DynKlank` UGen after discussing it last class. Decided to run some basic cafe background noise through it with specific frequencies. Setting the frequencies to scales gave quite an interesting result, so I'm thinking of maybe playing around with more scales next week and layering a couple of them on top of each other.

## 2/10

Unfortunately this week I was a bit more shortchanged on time than I would've liked due to assignments for other courses taking up more time than I originally expected. In any case, I spent my time focusing on `dynklank.scd`, as I really wanted to see about wrapping `DynKlank` in a `SynthDef`. My first attempt at all of this hit a bit of a snag- I was running into errors that I suspect might have to do with the requirement of using an array reference rather than a classic array. I was unable to find documentation online, but if I had to guess I think `DynKlank`'s parameters need to be known at initialization time, at least to a certain degree, in order for it to set up all of its internals correctly. The synth can be created just fine if everything is hardcoded. If all three members of the reference array are variables, the SuperCollider interpreter complains. If two of the members are variables and one is fixed, it does work, but from what I can tell it does not produce any audible sound. Very strange behavior, hopefully we can try and piece together what is happening in class.

For the time being I decided to ignore those parameters inside the reference array, and created a `SynthDef` that has knobs for literally everything else. More specifically, there are arguments for controlling the played back buffer (buffer itself, rate, starting frame). There are also arguments for messing with `DynKlank` itself (frequency scale, offset, and decay). Finally, there is control over an ASR envelope as well as panning and the out channel. After all of that, I set up a `Pbind` and began experimenting. There's still some finetuning to be had, but something about this stream it creates is facinating to me. There is an ebb and flow, where sometimes the randomness on the ASR envelopes line up such that the `DynKlank`s all surge, and at other times everything quiets down before it picks back up again. There's textures all over, with tiny scratches and repeated knocks that poke in at times, a product of the `DynKlank` parameters as well as the natural noises of the cafe samples themselves. It's just absolutely incredible that what is being produced is being sourced from three one-minute samples of just natural noise.

The plans for next week are to go back and revisit `chimes.scd`, and see if there's a way I can merry it together with this texture I just made. Other than that, if we do manage to figure out how to modify the reference array, I would like to try and sequence that in some sense. One idea on my mind is kind of slowly adding more and more resonators to the bank over time. If that doesn't work, I want to get a bit more intimate with each of the individual parameters do in order to nail down their behavior, figure out what exactly induces what. If I can figure that out, that should give a solid basis for formulating this into a composition.

## 2/16

After debugging in class last week the issue with passing parameters into `DynKlank`, I took the time to integrate that into my own synth along with some other improvements. First of all, converted the synth's arguments to use `NamedControl` as outlined in [this scsynth forum post](https://scsynth.org/t/namedcontrol-a-better-way-to-write-synthdef-arguments/186) (thank you Prof. Fieldsteel for pointing me towards this). I also used the array notation alongside `Pfunc` in order to share the selected buffer across two different arguments, instead of using `Pkey`. Finally, I added the `DynKlank` parameters to the synth.

Things seemed to work, at least at first, but I ran into two different issues when I began playing with the refined synth. First, I tried to set the `DynKlank` default parameters to be arrays of size one, but this was throwing an error related to a `.sum` call. It's not entirely clear to me why this would be a problem, considering that it appears `DynKlank` has fallback parameters of [440.0], [1.0], and [1.0], but a way to circumvent this issue is adding a set of zeroes on the end of each of the arrays.

After figuring that out, I tried to setup a `Pbind` similar to last week's with the new synth, and ran into a strange issue where only a few frequencies were poking through. A whole bunch of troubleshooting later, I encountered [this scsynth post](https://scsynth.org/t/problems-with-variable-literal-array-and-namedcontrol/941) that reminded me that arrays in a `SynthDef` must be fixed. The issue was that my default parameters were only a couple elements, and what it would do is it would take my more complex pattern and only grab the first couple frequencies, rather than the whole thing. In order to fix this, the `SynthDef` has to have arrays big enough to hold whatever is passed into it. My array is of length 25, but I figured I would try 50 to be safe (ex: default argument of `0!50`). This ended up tanking my CPU and SuperCollider slowly rolled to a halt. Long story short, `DynKlank` is not cheap, so I need to either make sure I don't reserve more resonators than needed (maybe define multiple `SynthDef`s of predefined sizes?) or find a way to use `DynKlank` more efficently. There might be a way to sum up the input signal that is fed to the `DynKlank` to achieve the same effect, but I also vary the `DynKlank` params heavily which allows me to achieve some of the more interesting textures.

## 2/17

Now that the synth was fixed and had all of its parameters available for tuning, I took to experimenting with each one of the parameters to see how their modifications affected a baseline sample. Of note was how the ringtimes could be modified to be extremely short or long; if short, the original sample would pass through as there is no time for the resonators to activate. If long, the pitches are held in a long smooth way that would be helpful for putting together a background drone. I also messed with lagging the parameters. I didn't expect it to work, but I was able to nest a `NamedControl` inside of another to provide an argument for lag. This was used to fun effect with the freqscale and decayscale arguments that are ultimately fed to `DynKlank`.

Other than that, I created a new composition-like `Pbind` that utilizes `Pfunc` to slowly add more pitches to the resonator bank as the pattern progresses onward. In addition to that, I modified some of the other parameters from the previous `Pbind` to take advantage of some of the behavior I noticed. There is certainly a bit more movement and direction to this `Pbind`, but I still need to devise a way to wind it back down after building up (currently it just cuts off).

With all that in mind, I want to see how I can bring another sample into the mix. The `chimes.scd` file was an interesting idea, but I feel like those pitches are a bit too well-defined and sharp to try and mix with this `DynKlank` setup. Next week will probably involve putting together another file that will land in the `Ideas` folder.

## 2/23

Last week I discovered that using `DynKlank` was quite wasteful, and instead I opted to use the UGen it calls, `Ringz` to do some of the heavy lifting. I can get a similar bank effect like `DynKlank` by feeding my patterns an array of arguments, which produces multiple `Ringz` simultaneously. Another thing that I noticed after taking a closer look at `Ringz`'s documentation is that the outputted amplitude is dependent on sample rate. From what I understand, `Ringz` was built to be uniform based on being sent an impulse the size of one sample, so the rate at which samples are sent is proportional to the amplitude. I'm locally developing on 44.1 kHz, so if my code was being played back at 48 kHz it would be louder. My code is already normalized quite high, so this could lead to some clipping. To remedy this, I scaled the amplitude of my synth down proportionally to 44.1 kHz, so hopefully that is an appropriate fix to that issue.

## 2/24

The goal for today was to try and put some code together that produces something a little more long form with some amount of intention. After some messing around, the resulting pattern starts with the raw audio, with some soft resonating `Ringz` that break through. The raw audio eventually fades out, but the `Ringz` remain. This is eventually connected up with the building pattern from last week, where it adds another resonator every 3 events. Finally, I created another pattern that mirrors the building pattern called descend that slowly removes resonators, with the only other difference being a greater tendency for longer ring times.

This "composition" is okay, but it's still a bit rough around the edges. The main thing is I want to see how I can get a smoother transition between the raw audio and the resonators. This might involving setting up some busses and feeding the audio both directly out and through my resonator synth. Aside from that, I'm a bit lost in terms of where to go from here. The composition is certainly trending towards some sort of drone/sound-mass piece, but I'm finding it difficult to try and add more considering how dense the spectrum tends to be already. I can cut down on the number of resonators, of course, but the question is what to put in it's place.

One possible direction might be to try and build up the environment I'm sourcing from. I'm imagining some sort of rainy, stormy day in a cafe and just cozying up with a drink. I've already started looking into some ways to produce rain, either from my samples or entirely synthetically ([sccode is certainly a good place to derive some inspiration from](https://sccode.org/tag/category/rain)). Maybe some sort of rough flow would involve opening with light rain and some intermittent thunder. The listener arrives at the cafe and enters, complete with the sound of a door opening and a bell. They're met with a softer version of the audio I'm currently using. They settle down, get comfortable, and just slowly mentally wander. How all of that translates to audio, I'm not even 100% sure, so we'll see how far story boarding like this gets but at least it gives some sort of plan to try and pursue.

## 3/3

Moved to a new file- `Ideas/coffeeshop.scd`. Today was spent trying to build out the landscape I described last week. I brought in a UGen for rain that I really liked ([which was originally found here](https://sccode.org/1-e)), and played around with buses and groups to try and route both the rain and the coffeeshop samples into my `Ringz` synth. Other than that, it's another crack at building a coherrent composition. Starts with the rain, slowly introduces some resonators. Then the listener enters the coffeeshop, again with some resonators easing in. Afterwards, this goes into that resonator build/descend from last week. The rain remains throughout the whole piece. 

Two musical things of note-
1) I noticed that my build/descend code wasn't even sampling from a scale correctly. It was just grabbing half-step offsets of 0 through 4 from the root note rather than using the scale's offsets, so that was corrected.
2) I also tried some sort of tonal shift between the build and descend. Going up (and all the way to that point, for that matter), all the resonators are tuned to F minor pentatonic. On the way back down, the descending resonator bank shifts to C major (but the rain-based resonators remain in F minor pentatnoic). I think it sounds okay, though it isn't too pronounced.

One other outstanding issue I have is I'm trying to see if there's a way to pass an Envelope into a `SynthDef`, but I think I'm running into the same fixed size array problem I saw earlier.

In any case, I want to try and lean into some sort of meditative sort of work. Prof. Fieldsteel brought up an analogy of a photograph morphing into a watercolor, and then fading out. Really like that image, and I want to try and go after that.

## 3/10

Given that the expected deliverable for this week involves rendering out the composition, work was done in the `Composition` folder this week. See `Composition/sketch.scd` for where the code is put together. Made everything runnable in one shot using `s.waitForBoot()` and `s.sync` appropriately. Also split off the `SynthDef`s into their own file, `Composition/synths.scd` using `loadRelative` to import the file in. Recording the file was done using the record button from the GUI generated by `s.makeGui`.

I started off work for this week by thinking about how to contrast the longer, soundmass-like properties of the resonators. I realized I was already using rain, so what if I tried to synthesize a raindrop noise? It would be something short and semi-percussive, and it would fit with the theme. After playing around with it for a while and not making any headway, I ended up on YouTube and found [this great tutorial for doing it in Serum](https://www.youtube.com/watch?v=IsddH9ntNhc). A bunch of messing around with envelopes later, and the `\raindrop` synth now exists. I also tried manufacturing my own rain sound using colored noise and a bunch of filters, but I didn't produce anything that sounded better than the existing `\rainmaker` synth. Nevertheless, it is in the file as the `\rain` synth.

In terms of the composition itself, I decided to take a step back from directly integrating the cafe audio into the piece. At least at the current moment, I think it's a bit too hard to smoothly transition into it. Rather than weighing into a coffee shop sort of narrative, I wanted to lean more into making some sort of meditative work involving the rain. Currently, the composition is in three parts. The first part is a bunch of raindrops that start sporadically but then increase in frequency as the storm rolls in. The second brings back the singing-bowl sounds from `Ideas/chimes.scd`. One thing I think works really well is that there are three initial 'gongs' that occur while dropping the amplitude of the `\rainmaker` synth ever so slightly. The amplitude changes are really noticable when they are by themselves, but these deep resonant blows hide it very well. The third part is the `Ringz` build up and wind down that I've been working on previously, except it progresses even faster. 3 minutes of it straight is a bit much, so I think halfing it down to 90 seconds should be long enough to explore some of the more interesting patterns without it being stale. As an aside, I ended up mixing a `Routine` and `Pbind`s together as I found it was more convenient for spacing patterns far apart from each other. Unfortunately things have to be hard coded but I think it's a resonable tradeoff compared to nesting one long `\rest` in a random `Pbind`.

I think I want to try and lean into the rain/storm idea a bit more. The storm naturally opens the door for some sort of chaotic / dissonant section, which could serve to counterbalance the smooth resonant `Ringz`. Just a thought, though I feel like making something dissonant but still tasteful and well-executed is easier said than done.

## 3/24

Took a detour from the whole rain idea for a week to try and put together some sort of stab/pad. One other thing of mention was I cleared out the SoundLibrary of all the samples not being used in order to save some space (the files will remain locally on my computer for the time being).

Work for this week was done in `Ideas/pluck.scd`. After a bunch of experimentation and digging around in SuperCollider, I happened upon the `Pluck` UGen. From my understanding, `Pluck` is an implementation of Karplus-Strong synthesis, which aims to simulate the sound of a plucked string, hence the name. The `plucky SynthDef` is based on the example provided in the documentation, but with a few more parameters that give finer control. Perhaps the most interesting thing about this is that the `Impulse` UGen is used to activate `Pluck`. Putting in a value of zero gives a single impulse, which is perfect for a singular pluck. However, increasing this causes the pluck to fire multiple times a second. Combine with a reverb, and it creates a fun echo effect. Ramp the number of impulses up even more, and it turns into a nice pad. The `Pbindefs` help illustrate some of the cool noises all achieved from this one `SynthDef`.

Back to the rain, I looked around online and found a collection of high quality samples of a storm from an online library called 99sounds. The pack is pay what you want, [and it can be found here](https://99sounds.org/rain-and-thunder/). Not sure if I want to integrate these samples directly or if I will just model some UGens after them, but regardless they will provide great reference. In addition to standard rain and loud thunderclaps, there are also some samples of rain hitting an umbrella and rain hitting a window which sound quite unique. Plan for next week is to try and put together some sort of set of earcandy, both from my existing sample library and from these new samples, as I feel like those tiny little elements are something I haven't done too much of so far.

## 4/7

Housekeeping: all of the synths I have made so far have been collected into `Ideas/synths.scd`, mirroring the setup in `Composition`. Work for this week can be found in `Ideas/rain_layering.scd`. Like I mentioned from last time, I wanted to see about integrating in some ear candy. So to do that, I went back to my sample library and picked up a few sounds. Namely: some typing from my mechanical keyboard, some sizzling from pan-frying, some ice in a cup, and a salt shaker. I also grabbed my `plucky SynthDef` from last week and some of the rain samples from 99sounds.

A bunch of `Pbindef`s and event parameter fiddling, I ended up with a baseline sound of rain hitting an umbrella with a bunch of other textural samples on top of it. In particular, I think that the typing pitched down goes quite well with the rain. All of this is bundled in a routine at the bottom with the various `Pbindef`s being started or stopped every 16 seconds. Overall I think the layers create a nice smooth movement, though the pad chords that come in don't fit quite as well as the high pitched plucks when they enter. Regardless, the original rain sample does leave, but it still does sound "rainy," which is what I was looking to achieve.

## 4/14

Work for this week can be found in `Ideas/rain_layering.scd`. There were a few minor changes inside of `Ideas/synths.scd` where some additional parameters were either added or tweaked, but nothing worth too going into. There is also a `\master SynthDef` now which all sound is piped into and the volume/panning/minor filtering can take place if needed.

`rain_layering.scd` now has a fairly standard setup for creating and tearing down busses for the purposes of using some effects. The `\reverb SynthDef` I had previously played with a little as well as the aforementioned `\master SynthDef` have `~bus.rev` and `~bus.master` feeding into them, with `\reverb` outputting to `~bus.master`. The reverb helps to give some extra body to the samples being piped into it. Might play around with this a little more next week as I haven't fully experimented with the feedback and mix parameters. I also gave most of my synths the option to have an auxillary send in the event that I want to split the audio chain rather than going all sequentially. The samples from last week are still present (rain, mechanical keyboard typing, pan sizzle, ice, salt), and the newcomer for this week are the sound of metal beads hitting a metal window frame. The thought process was that if I slow the sample down enough and filter it sufficently it would get me a "boomy" thunder-like noise. I additionally integrated in some of the `Ringz` work I did a while back to add some more sonic action in the lower register. Everything leans heavily on `Env.asPseg` to fade everything in and out gradually. Still using a `Routine` and `Pbindef`s with planned out `wait` calls in order to sequence everything, currently the sequence is around four and a half minutes.

The "thunder" sounds okay, but I have too main problems with it. First, there is definitely still some pitch content that is present even after it has been extremely slowed down, so I might need to add some noise to the signal to try and hide that. Second, there is an initial "strike" of sorts but it doesn't linger or have follow-up hits, if that makes sense. This might be best managed by a delay of some sort. The storm is certainly starting to take shape, but it still needs a bit more of a bite to it, more intensity. Maybe there will be a brief "eye of the storm" segment towards the center of the composition where things calm slightly, and maybe I can use that resonator build setup from earlier to get the action I desire.

## 4/21

Work for this week is in `Ideas/rain_layering.scd`. Only change in `Ideas/synths.scd` was a `SynthDef` from Prof. Fieldsteel that made a better thunder sound out of the curtain beads - the synth is named `\thunderbeads`. Additionally I added some more heavy thunder samples from 99Sounds to the sound library. The samples are extremely loud and terrifying, so be very careful if you listen to them.

Continuing on in this rain storm composition that has yet to be named, the next task was building an intense, chaotic section. I decided to keep the `\beads SynthDef` I had before, and I supplanted it with `\thunderbeads` and a sampler `Pbindef` named `\heavythunder` that plays the 99Sounds samples. The three of these together provide some nice action in the lower audio spectrum. In order to really drive home the energy of a storm, I revisited my `\plucky SynthDef`, and decided to explore the area between singular plucks and chords. More specifically, what happens if the chord is played with 10-100 impulses per second? There is a sense of urgency as the hits are quite fast. I used `PGeom` to slowly ramp up the impulse rate, and set the envelopes and durations such that there are overlap between each of the chords. A nice side effect of this overlap and the tap rate slowly increasing is that between both chords there is a nice aliasing effect as the next chord will outpace the first but only by a small factor. There is a buzz of sorts that wavers in and out slightly. This can all be found in the `\intensepad Pbindef`. I attached it to the end of the routine housing the current iteration of the composition, which is now at 6.5 minutes. I also included an additional routine at the bottom with just the new section. 

Mixing on this section still isn't complete, and there is occasional clipping. I might swap over to using `\db` keys instead of `\amp` to see if that makes my life a little easier. Just trying to strike a good balance between intensity and not fatiguing the listener. Currently there is no transition out of this section- it just drops out. Next week is trying to figure out what the payoff of this riser is- what is being built towards. Maybe I have the thunder strike loudly and suddenly there is an eerie eye of the storm calm, then deescalating the storm. Still figuring this out. After that, it's about making sure the pacing is where I want it to be and putting on the last touches and details.

## 4/28

Work for this week is in `Ideas/rain_layering.scd`. One `SynthDef` was added to `Ideas/synths.scd`; `\wind` is exactly what it says it is on the tin: a wind maker. Fairly straightforward, just some stereo white noise run through a filter with some modulation on it.

Working title for this composition is "The Eye." Goal for this week was to add a section representing the eye of the storm. I want it to be eerie and calm in sharp contrast to the all of the thunder we left behind. The wind was used in this section, but in addition to that I brought back the `ringzBuild` and `ringzDescend` `SynthDef`s from back when I was still playing with the Cafe samples. The only difference here is in addition to passing the cafe samples, I also pass the rain and thunder samples I was using previously. Levels are still being tweaked- unfortunately the random parameters inside of these two `Pbindef`s can cause a lot of variance in the output, so sometimes it is fine and other times there is a bit of clipping. There is a `Limiter` being used in my `\master` `SynthDef` but it is quite noticible. I suspect this is due to the the three sets of samples I am passing (cafe / rain / thunder) are all at varying levels. What I might need to do is break these apart into three separate patterns and adjust their amplitudes individually.

All said and done, the composition is at around 9.5 minutes, and I still want to add one more section where the listener exits the eye, and is pulled back into the fierce part of the storm, and then it gradually eases out. I'll need to see what happens when I build this last part, but I might try and take a look at the pacing of everything and potentially shrink what I currently have by some factor to keep everything engaging. Will also take a final pass to try and add some more detailing with some samples, and make sure levels are where I want them to be, including what I mentioned above with the build/descend. Also, the transition from the thunder into the eye still isn't quite right to me. I basically tried to have a loud thunderclap accent everything and then stopped all the running patterns, but it is still a bit off to me, maybe because of the length of the tail on the other patterns.